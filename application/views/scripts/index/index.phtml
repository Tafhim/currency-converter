<style>
    a:link,
    a:visited
    {
        color: #0398CA;
    }

    span#zf-name
    {
        color: #91BE3F;
    }

    div#welcome
    {
        color: #FFFFFF;
        background-image: url(http://framework.zend.com/images/bkg_header.jpg);
        width:  100%;
        height: 100%;
        border: 2px solid #444444;
        overflow: hidden;
        text-align: center;
    }

    div#more-information
    {
        background-image: url(http://framework.zend.com/images/bkg_body-bottom.gif);
        height: 100%;
    }
</style>

<?php if ( count($this->history) ) { ?>
<table id="history-table">
    <thead>
        <th>From currency</th><th>From</th><th>To</th><th>To currency</th>
    <thead>
    <tbody>
    <?php foreach ($this->history as $history) { ?>
        <tr>
            <td><?php echo $history->getFrom(); ?></td><td><?php echo $history->getFromAmount(); ?></td><td><?php echo $history->getToAmount(); ?></td><td><?php echo $history->getTo(); ?></td>
        </tr>
    <?php } ?>
    </tbody>
</table>
<?php } ?>

<?php echo $this->converterForm; ?>

<script type="text/javascript">
    (function($) {
        $(document).ready(function($) {
            // Call the api for currenty rates
            $(document).on('submit', '#currency-converter', function(evt) {
                // Stop the default request behavior
                evt.preventDefault();

                // Get all the form data for ajax 
                form = 'form#currency-converter';
                formData = new FormData();
                formData.append('convert_from', $(form).find('[name="convert_from"]').val());
                formData.append('from_currency', $(form).find('[name="from_currency"]').val());
                formData.append('to_currency', $(form).find('[name="to_currency"]').val());

                // Table for history
                table_last_row = 'table#history-table tr:last';
                
                // Push an ajax post request with all the data
                $.post({
                    url: 'rate/convert/format/json',
                    dataType: 'json',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        $(form).find('[name="convert_to"]').val(response.result);
                        $(table_last_row).after('<tr><td>'+formData.get('from_currency')+'</td><td>'+formData.get('convert_from')+'</td><td>'+response.result+'</td><td>'+formData.get('to_currency')+'</td></tr>');
                    }
                });
                return false;
            });
        });
    })(jQuery);
</script>